.. _log:

**************
3. Логирование
**************

.. _main_log:

3.1. Основной лог-файл
======================

**micromanager.log** - основной лог-файл. Сообщения имеют вид: ::
  
  %timestamp% %log_level% %function%[%PID%]: %message%
  
Пример: ::
  
  Thu Mar 30 17:30:52 2017 INFO ingestion_thread_handler[29731]: (ED.mp4) ingestion process thread stopped
  
Возможные уровни сообщений в порядке увеличения детализированности лога (каждый следующий уровень включает в себя предыдущие уровни):

- CRITICAL - критические ошибки, влияющие непосредственно на работу процесса micromanager: ошибки вызова fork(), popen() и link(), обработки сигналов и прочее.
- ERROR - значительные ошибки: ошибки чтения конфигурации, ошибки работы дочерних процессов (в т.ч. ненулевой код возврата), работы с сетью и др.
- WARNING - предупреждения: ошибки вызова API, сообщения о перезапуске задачи из-за ошибки и др.
- INFO и NOTICE - информационные сообщения.
- DEBUG - малозначительные сообщения, полезные для отладки.

Список некоторых возможных сообщений приведён в разделе :ref:`Список возможных кодов и сообщений лога micromanager <log_message_list>`.
  
.. _state_log:

3.2. Лог состояния
==================

Если параметр log-state-period больше нуля, то micromanager с заданной периодичностью в минутах будет вести лог состояния.

Вид записей лога: ::

  Log OK: 28/09 06:24:49
  Mem used: 3790604 KiB, mem free: 267952 KiB
  Swap used: 25728 KiB, swap free: 8359804 KiB
  CPU load: 6.0%
  In VoD directory: 255539 MiB free
  __________________________________________________________________________________________________________________________________
  | NAME                  | ENABLE| SRC                    | DST                            | STATE         | BITRATE  | STOP TIME |
  ----------------------------------------------------------------------------------------------------------------------------------
  | Еврокино              | true  | udp://@239.1.2.3:5000  | 239.120.0.6 1234 multicast udp | NOT_RUNNING   | -        | -         |

  ________________________________________
  | PATH                                  |
  ----------------------------------------
  | Sintel                                |
  | ED.avi                                |
  | failfile                              |

Каждая запись лога состояния содержит две таблицы: таблицу потоков и список файлов в директории ожидания (по умоллчанию /var/vod_ingest).
  
Поля таблицы потоков:
  
- NAME - Имя потока.
- ENABLE - true, если поток включен.
- SRC - Источник потока.
- DST - Исходящий адрес потока.
- STATE - Статус потока (RUNNING, NOT_RUNNING, NO_STREAM_DATA, NO_PLAYLIST, NOT_SEGMENTING).
- BITRATE - Текущий битрейт потока.
- STOP TIME - Время, когда будет остановлен поток. 
